FIXME：
1. 这里应该先总体介绍（看看Pagerduty）
2. 然后另起2篇介绍keycloak和Authing

## 快速了解
---

FlashDuty目前提供SAML2.0和OIDC两种协议的单点登录（SSO）接入，可以帮助您快速实现与其他平台共享身份信息，同时我们提供了Keycloak的配置文档供参考

---
## 配置SAML协议

Keycloak是一款开源的身份和访问管理平台，能够轻松帮您搞定用户登录验证、权限分配等工作

:::tip

本篇文章不涉及部署和讲解Keycloak相关内容，如需了解Keycloak更多信息，请参考[官方文档](https://www.keycloak.org/)

:::

### 1.登录FlashDuty控制台
- 从FlashDuty获取acs地址（第2步会用到）
- 路径：访问控制--->单点登录--->设置--->SAML2.0协议---->Flashcat服务提供商信息--->Assertion Consumer Service URL
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437194/image-preview)

### 2.登录Keycloak控制台新建一个Client
- 路径：Clients ---> Create client
- Client Type：选择SAML协议
- Client ID填写： flashcat.cloud（固定值，不可更改）
- Valid redirect URIs 填写从FlashDuty获取的acs地址
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437197/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437029/image-preview)

### 3.配置Client相关信息

- Name ID format 更改为email类型
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437031/image-preview)

- Client signature required 设置为关闭状态
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437195/image-preview)


- 创建email，phone，username三种字段类型
:::tip

创建之前需要先删除之前OpenID Connect协议的用户，创建完成设置为Default

:::
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437033/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437034/image-preview)

- 将添加的用户加入到Client中
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437037/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437038/image-preview)


- 配置email/phone/username映射器(以email为例，其他按照下面步骤配置即可)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437057/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437058/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437060/image-preview)

### 4.下载XML文件
:::tip

下载的文件是一个压缩包，在本地解压后会有两个xml文件，只需要idp-metadata.xml文件即可

:::
 - 在Client--->Action中下载到本地
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437039/image-preview)

- 上传XML文件到FlashDuty的单点登录配置中
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437040/image-preview)


### 5.在Keycloak创建用户并测试登录

- 创建用户（一定要绑定一个邮箱地址）
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437041/image-preview)

- 登录测试：console.flashcat.cloud，选择SSO登录---域名处填写单点登录配置中登录域名前缀
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437062/image-preview)

## 配置OIDC协议

### 1.登录FlashDuty平台
- 从FlashDuty获取Redirect URL（第2步会用到）
- 路径：访问控制--->单点登录--->设置--->OIDC协议---->Flashcat服务提供商信息--->Redirect URL
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437183/image-preview)

### 2.登录Keycloak控制台新建一个Client

- Client Type：选择OIDC协议
- Clinet ID：没有特殊要求
- Client authentication：保持开启状态
- Valid redirect URIs：填写第1步获取的Redirect URL地址

![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437179/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437180/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437184/image-preview)

### 3.获取Client的相关信息

- Client ID：创建Client时填写的ID
- Client Secret：Client详情->Credentials卡片中即可看到
- Issuer：Realm settings->Endpoints->OpenID Endpoint Configuration

![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437186/image-preview)
![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437187/image-preview)

### 4.FlashDuty单点登录配置样式

![image.png](https://api.apifox.com/api/v1/projects/4169655/resources/437188/image-preview)

- 配置完成后在Keycloak创建用户并绑定邮箱即可实现登录
- 登录测试：console.flashcat.cloud，选择SSO登录---域名处填写单点登录配置中登录域名前缀