通过 webhook 的方式同步腾讯云日志服务 CLS 监控告警事件到快猫星云，实现告警事件自动化降噪处理。

## CLS 配置
---

**步骤 1：配置 通知渠道组**

<div class="md-block">

1. 登录您的腾讯云控制台，选择日志服务 CLS 产品，进入 监控告警 - 通知渠道组
2. 单击 `新建` 开始新建

<img alt="drawing" width="600" src="https://fcpub-1301667576.cos.ap-nanjing.myqcloud.com/flashduty/integration/tencent-cls/tencent-cls-notify.png" />

3. 如图，`名称` 填写具体的渠道组名称，`渠道类型`选择“自定义接口回调”，`回调地址` 填写集成的推送地址，`请求方法` 选择POST

4. 点击 `确定` 保存， `添加` 可以添加多个渠道

</div>

**步骤 2：配置 告警策略**

<div class="md-block">


1. 登录您的腾讯云控制台，选择日志服务 CLS 产品，进入 监控告警 - 告警策略
2. 单击 `新建` 开始新建

<img alt="drawing" width="600" src="https://fcpub-1301667576.cos.ap-nanjing.myqcloud.com/flashduty/integration/tencent-cls/tencent-cls-alert.png" />

3. 如图，`告警名称`填写具体的告警名称，日志主题选择具体的日志主题

4. `执行语句` 填写具体的查询语句，查询时间范围选择时间范围，点击预览可以查看执行的结果，触发条件输入具体的触发条件

5. `告警级别`，分为紧急、告警和提醒，根据告警的严重程序选择，执行周期根据需要选择

6. `多维分析`，触发告警时可针对原始日志进行额外的检索分析，将结果附加在告警通知中，以辅助定位告警原因。多维分析不会影响告警触发条件。

7. 告警通知，`通知渠道组`，可以关联到具体的渠道组

</div>


**步骤 3：配置 自定义回调**

<div class="md-block">

1. 关联渠道组后，可以看到回调内容配置

2. 请求头，可以添加具体的请求的headers

3. 请求内容，返回具体的请求数据格式，参考：

```json
{
    "uin": "{{escape .UIN}}",
    "nickname": "{{escape .Nickname}}",
    "region": "{{escape .Region}}",
    "alarm": "{{escape .Alarm}}",
    "alarm_id": "{{escape .AlarmID}}",
    "condition": "{{escape .Condition}}",
    "happen_threshold": "{{escape .HappenThreshold}}",
    "alert_threshold": "{{escape .AlertThreshold}}",
    "topic": "{{escape .Topic}}",
    "topic_id": "{{escape .TopicId}}",
    "level": "{{escape .Level}}",
    "label": {{.Label}},
    "start_time": "{{escape .StartTime}}",
    "start_time_unix": "{{escape .StartTimeUnix}}",
    "notify_time": "{{escape .NotifyTime}}",
    "notify_time_unix": "{{escape .NotifyTimeUnix}}",
    "notify_type": "{{escape .NotifyType}}",
    "consecutive_alert_nums": "{{escape .ConsecutiveAlertNums}}",
    "duration": "{{escape .Duration}}",
    "trigger_params": "{{escape .TriggerParams}}",
    "record_group_id": "{{escape .RecordGroupId}}",
    "detail_url": "{{escape .DetailUrl}}",
    "query_url": "{{escape .QueryUrl}}",
    "message": {{.Message}},
    "query_result": {{.QueryResult}},
    "query_log": {{.QueryLog}},
    "analysis_result": {{.AnalysisResult}}
}
```

</div>


## 状态对照
---
<div class="md-block">

腾讯云CLS监控告警级别到快猫星云映射关系：

| 腾讯云 CLS 监控 | 快猫星云   | 状态
| ------------- | --------- | --- |
| Info          |  Info     | 提醒
| Warn          |  Warning  | 警告
| Critical      |  Critical | 紧急

</div>
