通过 webhook 的方式同步夜莺（Nightingale / n9e）告警事件到快猫星云，实现告警事件自动化降噪处理。
---

## 使用限制（如有）
---


## 支持版本
---

夜莺 V5，V6 及以上版本。


## 操作步骤
---


### Flashduty 控制台


#### 使用专属集成


#### 使用共享集成


### 集成名称 控制台


## 严重程度映射关系
---


## FAQ
---







通过 webhook 的方式同步夜莺（Nightingale / n9e）告警事件到快猫星云，实现告警事件自动化降噪处理。

支持 V5.0 及以上版本。

## 一、夜莺配置

两种配置方式任选其一。

### 方式 1：按策略配置

<div class="md-block">
  
批量选择告警规则并配置 webhook。

1. 登录您的 n9e 控制台，选择 告警管理 > 告警规则，进入告警规则列表页面
2. 批量选中您期望导入的告警规则，右上角选择批量更新告警规则
3. 在弹窗中选择“回调地址”字段，新增输入框中填写集成的推送地址，如下图所示：

<img alt="drawing" width="600" src="https://download.flashcat.cloud/saas-n9e-rule.png" />

4. 回到集成列表，如果展示了最新事件时间，说明配置成功且收到事件
5. 完成

</div>

### 方式 2：全局配置

<div class="md-block">
夜莺支持在页面和配置文件中配置全局 webhook 地址，推送所有的告警事件。以下两种方式二选一即可。

#### V6 及以上版本

1. 登录您的 n9e 控制台
2. 进入`系统配置-通知设置-回调地址`页面
3. 如下图所示，启用一个新的 webhook，`URL` 部分填写集成的推送地址

<img alt="drawing" width="600" src="https://download.flashcat.cloud/flashduty/integration/n9e/n9e_v6_webhook.png" />

4. 完成

#### V5.4~5.15 版本

1. 登录您的 n9e server 实例
2. 找到并打开配置文件，一般为 etc/server.conf
3. 更改 Alerting 配置部分，写入 Webhook 配置，如下

   ```receiver config
   [Alerting.Webhook]
   Enable = true
   Url = "{api_host}/event/push/alert/n9e?integration_key=$integration_key"
   BasicAuthUser = ""
   BasicAuthPass = ""
   Timeout = "5s"
   Headers = ["Content-Type", "application/json", "X-From", "N9E"]
   ```

   您需要替换 Url 对应的参数值为集成的推送地址。

4. 保存配置文件
5. 重启 n9e server，使配置生效
6. 回到集成列表，如果展示了最新事件时间，说明配置成功且收到事件
7. 完成

</div>

## 二、状态对照

<div class="md-block">
  
n9e 到快猫星云告警等级映射关系：

| n9e | 快猫星云 | 状态 |
| --- | -------- | ---- |
| 1   | Critical | 严重 |
| 2   | Warning  | 警告 |
| 3   | Info     | 提醒 |

</div>
